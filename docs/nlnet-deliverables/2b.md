# 2b. Initial deployment for customised bonfire MVP/dev/staging

## EKS / Kubernetes on AWS Infrastructure

1) Early research required becoming familiar with the docker-compose based setup in the Bonfire repositories and assessing viability to deploy Bonfire on Kubernetes. 
- Decode and translate the conventions for bonfire container image selection in Just and docker compose
- extracting the environment variables needed for our kubernetes deployment
- assessing viability of using AWS services for object store, databases.

2) Deploying the system in kubernetes using an iterative process:
- Assess the next smallest, enabling step
- Familiarise the equivalent setup in the docker compose setup
- Translate and design the equivalent kubernetes configuration
- Deploy and observe any issues with that enabling step
- Plan next enabling step

In doing so, we gradually recreated deployment configuration for:
- Deploy a Deployment object for OpenScience flavour container image via a kustomization
- Deploy Service and Ingress objects to expose the web interface via the kustomization
- Deploy a Postgres database for bonfire (via kubernetes operator) with auto-generated credentials injected into bonfire instances via kustomization
- Deploy Meilisearch for Bonfire via community helm chart, and configure Bonfire via the kustomization.
- Work with the Bonfire devs to identify a bug found with database migrations in openscience flavour of bonfire.
- Enable image uploads to S3 via IRSA ephemeral credentials, a feature unique to AWS Kubernetes environments
- Continuous Deployment via FluxCD, overcoming issues with Semantic Versioning with the Bonfire image tags.

## Helm

In addition to deploying discussions.sciety.org on the elife AWS cluster, we also researched possibilities of reusing this learning through the creation of a [Helm chart](https://helm.sh/), a package manager for Kubernetes offering another alternative for communities wishing to deploy Bonfire.

[Helm chart for deploying Bonfire on Kubernetes cluster](https://github.com/sciety/bonfire-helm-chart/)
